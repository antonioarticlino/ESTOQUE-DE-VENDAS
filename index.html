<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Estoque de Pe√ßas</title>

<style>
:root{
  --primary:#3b82f6;
  --secondary:#22d3ee;
  --success:#22c55e;
  --danger:#ef4444;
  --bg:#020617;
  --card:#0f172a;
  --text:#e5e7eb;
}

body{
  margin:0;
  padding:12px;
  background:radial-gradient(circle at top,#111827,#020617);
  font-family:Segoe UI,Arial;
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  background:linear-gradient(180deg,#0f172a,#020617);
  padding:18px;
  border-radius:14px;
}

h1{text-align:center;color:var(--secondary);}

input,select,button{
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(59,130,246,.3);
  background:#020617;
  color:var(--text);
}

button{
  cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#020617;
  font-weight:bold;
  border:none;
}

.filtros,form{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th{
  background:rgba(59,130,246,.15);
  color:var(--secondary);
  padding:10px;
  cursor:pointer;
  user-select:none;
}

th:hover{background:rgba(59,130,246,.25);}

td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.08);
  text-align:center;
}

.vendido{color:var(--danger);font-weight:bold;}
.disponivel{color:var(--success);font-weight:bold;}

.btn-remover{
  background:linear-gradient(135deg,#ef4444,#b91c1c);
  color:#fff;
}

@media(max-width:600px){
  table,thead,tbody,th,td,tr{display:block}
  thead{display:none}
  tr{
    background:#020617;
    margin-bottom:12px;
    border-radius:12px;
    padding:10px;
  }
  button{width:100%;margin-top:6px}
}
</style>
</head>

<body>

<div class="container">
<h1>Estoque de Pe√ßas</h1>

<div class="filtros">
  <input id="pesquisa" placeholder="Pesquisar produto" style="flex:1">
</div>

<form id="formProduto">
  <input id="nome" placeholder="Nome do produto" required>
  <select id="categoria" required>
    <option value="">Categoria</option>
    <option>Placa-m√£e</option>
    <option>Processador</option>
    <option>Mem√≥ria RAM</option>
    <option>Placa de v√≠deo</option>
    <option>Fonte</option>
    <option>Gabinete</option>
    <option>Outros</option>
  </select>
  <button type="submit">Adicionar</button>
</form>

<table>
<thead>
<tr>
  <th>Produto</th>
  <th onclick="alternarCategoria()">Categoria</th>
  <th onclick="alternarStatus()">Status</th>
  <th>A√ß√µes</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  deleteDoc, doc, updateDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDtmu5yKt5Kz8yxzTCCf5MfC2av1O5zL2Q",
  authDomain: "lojavendas-ae418.firebaseapp.com",
  projectId: "lojavendas-ae418",
  storageBucket: "lojavendas-ae418.firebasestorage.app",
  messagingSenderId: "241091939383",
  appId: "1:241091939383:web:b676e35c3c8c7c45c183b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("lista");
const form = document.getElementById("formProduto");
const nome = document.getElementById("nome");
const categoria = document.getElementById("categoria");
const pesquisa = document.getElementById("pesquisa");

let produtos = [];
let filtroStatus = "todos";
let filtroCategoriaAtivo = false;

// üî• realtime
onSnapshot(collection(db,"produtos"), snap=>{
  produtos = snap.docs.map(d=>({id:d.id,...d.data()}));
  renderizar();
});

function renderizar(){
  lista.innerHTML="";
  const termo = pesquisa.value.toLowerCase();

  produtos.forEach(p=>{
    if(termo && !p.nome.toLowerCase().includes(termo)) return;
    if(filtroStatus==="vendido" && !p.vendido) return;
    if(filtroStatus==="disponivel" && p.vendido) return;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.nome}</td>
      <td>${p.categoria}</td>
      <td class="${p.vendido?'vendido':'disponivel'}">
        ${p.vendido?'Vendido':'Dispon√≠vel'}
      </td>
      <td>
        <button onclick="alterarStatus('${p.id}')">Status</button>
        <button class="btn-remover" onclick="removerProduto('${p.id}')">Remover</button>
      </td>
    `;
    lista.appendChild(tr);
  });
}

// üîÑ clique no cabe√ßalho STATUS
window.alternarStatus = ()=>{
  filtroStatus =
    filtroStatus==="todos" ? "disponivel" :
    filtroStatus==="disponivel" ? "vendido" :
    "todos";
  renderizar();
};

// üîÑ clique no cabe√ßalho CATEGORIA
window.alternarCategoria = ()=>{
  filtroCategoriaAtivo = !filtroCategoriaAtivo;
  produtos.sort((a,b)=>
    filtroCategoriaAtivo
      ? a.categoria.localeCompare(b.categoria)
      : 0
  );
  renderizar();
};

form.addEventListener("submit",async e=>{
  e.preventDefault();
  await addDoc(collection(db,"produtos"),{
    nome:nome.value,
    categoria:categoria.value,
    vendido:false
  });
  form.reset();
});

window.alterarStatus = async id=>{
  const p = produtos.find(x=>x.id===id);
  if(!p) return;
  await updateDoc(doc(db,"produtos",id),{vendido:!p.vendido});
};

window.removerProduto = async id=>{
  await deleteDoc(doc(db,"produtos",id));
};

pesquisa.addEventListener("input",renderizar);
</script>

</body>
</html>
