<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estoque Mobile</title>

<style>
:root{
  --primary:#3b82f6;
  --secondary:#22d3ee;
  --success:#22c55e;
  --danger:#ef4444;
  --bg:#020617;
  --card:#0f172a;
  --text:#e5e7eb;
}

body{
  margin:0;
  padding:10px;
  background:radial-gradient(circle at top,#111827,#020617);
  font-family:Segoe UI,Arial;
  color:var(--text);
}

.container{
  max-width:100%;
  margin:auto;
}

h1{
  text-align:center;
  color:var(--secondary);
  font-size:1.4rem;
}

input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(59,130,246,.3);
  background:#020617;
  color:var(--text);
  font-size:1rem;
}

button{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#020617;
  font-weight:bold;
  border:none;
}

.filtros,form{display:grid;gap:10px;margin-bottom:12px;}

.contadores{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-bottom:12px;
}

.card{
  background:linear-gradient(135deg,#020617,#0f172a);
  border:1px solid rgba(59,130,246,.3);
  border-radius:12px;
  padding:10px;
  text-align:center;
  font-size:.9rem;
  font-weight:bold;
}

.card.total{color:#38bdf8;}
.card.disponivel{color:#22c55e;}
.card.vendido{color:#ef4444;}

.lista{display:grid;gap:10px;}

.item{
  background:#020617;
  border:1px solid rgba(255,255,255,.1);
  border-radius:12px;
  padding:10px;
}

.status.disponivel{color:var(--success);font-weight:bold;}
.status.vendido{color:var(--danger);font-weight:bold;}

.botoes{display:grid;gap:6px;margin-top:6px;}
.btn-remover{background:linear-gradient(135deg,#ef4444,#b91c1c);color:#fff;}
</style>
</head>
<body>

<div class="container">
<h1>üì¶ Estoque Mobile</h1>

<div class="contadores">
  <div class="card total" onclick="setFiltro('todos')">Total<br><span id="total">0</span></div>
  <div class="card disponivel" onclick="setFiltro('disponivel')">Disp.<br><span id="disponiveis">0</span></div>
  <div class="card vendido" onclick="setFiltro('vendido')">Vend.<br><span id="vendidos">0</span></div>
</div>

<div class="filtros">
  <input id="pesquisa" placeholder="Pesquisar produto">
  <select id="filtroCategoria">
    <option value="">Todas categorias</option>
    <option>Placa-m√£e</option>
    <option>Processador</option>
    <option>Mem√≥ria RAM</option>
    <option>Placa de v√≠deo</option>
    <option>Fonte</option>
    <option>Gabinete</option>
    <option>Outros</option>
  </select>
</div>

<form id="formProduto">
  <input id="nome" placeholder="Nome do produto" required>
  <select id="categoria" required>
    <option value="">Categoria</option>
    <option>Placa-m√£e</option>
    <option>Processador</option>
    <option>Mem√≥ria RAM</option>
    <option>Placa de v√≠deo</option>
    <option>Fonte</option>
    <option>Gabinete</option>
    <option>Outros</option>
  </select>
  <button type="submit">Adicionar</button>
</form>

<div class="lista" id="lista"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDtmu5yKt5Kz8yxzTCCf5MfC2av1O5zL2Q",
  authDomain: "lojavendas-ae418.firebaseapp.com",
  projectId: "lojavendas-ae418",
  storageBucket: "lojavendas-ae418.firebasestorage.app",
  messagingSenderId: "241091939383",
  appId: "1:241091939383:web:b676e35c3c8c7c45c183b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("lista");
const form = document.getElementById("formProduto");
const nome = document.getElementById("nome");
const categoria = document.getElementById("categoria");
const pesquisa = document.getElementById("pesquisa");
const filtroCategoria = document.getElementById("filtroCategoria");

let produtos = [];
let filtroStatus = "todos";

onSnapshot(collection(db,"produtos"), snap=>{
  produtos = snap.docs.map(d=>({id:d.id,...d.data()}));
  atualizarContadores();
  renderizar();
});

function atualizarContadores(){
  total.textContent = produtos.length;
  vendidos.textContent = produtos.filter(p=>p.vendido).length;
  disponiveis.textContent = produtos.filter(p=>!p.vendido).length;
}

function renderizar(){
  lista.innerHTML="";
  let dados=[...produtos];

  if(filtroStatus==="vendido") dados=dados.filter(p=>p.vendido);
  if(filtroStatus==="disponivel") dados=dados.filter(p=>!p.vendido);

  if(pesquisa.value)
    dados=dados.filter(p=>p.nome.toLowerCase().includes(pesquisa.value.toLowerCase()));

  if(filtroCategoria.value)
    dados=dados.filter(p=>p.categoria===filtroCategoria.value);

  dados.forEach(p=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <strong>${p.nome}</strong><br>
      <small>${p.categoria}</small><br>
      <span class="status ${p.vendido?'vendido':'disponivel'}">
        ${p.vendido?'Vendido':'Dispon√≠vel'}
      </span>
      <div class="botoes">
        <button onclick="mudarStatus('${p.id}')">Alterar status</button>
        <button class="btn-remover" onclick="removerProduto('${p.id}')">Remover</button>
      </div>
    `;
    lista.appendChild(div);
  });
}

window.setFiltro=t=>{filtroStatus=t;renderizar()};

form.addEventListener("submit",async e=>{
  e.preventDefault();
  await addDoc(collection(db,"produtos"),{nome:nome.value,categoria:categoria.value,vendido:false});
  form.reset();
});

window.mudarStatus=async id=>{
  const p=produtos.find(x=>x.id===id);
  if(p) await updateDoc(doc(db,"produtos",id),{vendido:!p.vendido});
};

window.removerProduto=async id=>{
  await deleteDoc(doc(db,"produtos",id));
};

pesquisa.addEventListener("input",renderizar);
filtroCategoria.addEventListener("change",renderizar);
</script>
</body>
</html>
